# Dock Web3 ID

This service provides a SSI-friendly authentication solution for use with DIDs and Verifiable Credentials. There is an existing live service hosted at https://auth.dock.io however you may clone this repository/deploy it to vercel to spin up your own instance. It is mostly stateless, but does rely on a memcached instance currently for short-lived data transfer. No long term storage of user data is used, tokens and codes are obtained through cryptography. You can use this service to allow your users to provide their own user data, like you would request from "Login with Facebook" or "Sign in with Github".

Note: You will still want to verify a users email if requested with this service.

Features:
- No long term storage of user/client data
- User provides and controls their own data
- Uses `did:dock` and `did:key` DIDs
- Cryptographic client id/secrets
- Oauth2 spec compliant

Roadmap:
- Support requesting specific credentials/data
- Decouple verification from the Dock API
- Look into supporting the SIOP spec
- OpenID Connect implementation
- Support more DID types
- Support non self-signed credentials

## As an oauth2 provider

This service can be used directly as an oauth2 provider with your favourite oauth library. See the documentation for [Oauth2 setup](docs/oauth2_setup.md). You are welcome to use our hosted version or your own. Setup instructions are for the hosted vesion, simply replace with your own domain to configure for another endpoint.

## As an Auth0 connection

This service can be used as an Auth0 Social Connector allowing users to sign into applications using their DIDs. See [Auth0 Application Setup](docs/auth0_configure_application.md)

## Under the Hood

Decentralized Identifiers (DIDs) are cryptographically verifiable pseudonymous identifiers created by the user, owned by the user, and independent of any organization. DIDs contain no personal data about the user, the user may provide extra data you request such as their name, email etc. An example of a DID stored on the Dock blockchain could look like this:

![sample-did](./public/DID%20example.jpg)

Each DID is supported by a Public-Private cryptographic key pair.

When a user scans the QR Code generated by the Dock Web3 ID Auth0 integration, the user’s Private Key associated with the DID digitally signs a Verifiable Credential. This Verifiable Credential contains a cryptographic hash that ensures that it wasn’t modified since it was created and signed - and most importantly verifies that the user who owns that DID is providing that data.

This Authentication Verifiable Credential is sent to this auth service, which verifies that the credential was indeed cryptographically signed by the correct user and grants the user access to the application. Your server can then request the user data using the access token provided through the standard oauth2/auth0 flow.

## Development

First, setup [#env-vars](the environment variables) and pre-requisite services and then you can run the development server:

```bash
npm run dev
# or
yarn dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

## Building and Deployment

Building the application for production can be done with:

```bash
npm run build
# or
yarn build
```

or you may wish to run it as a custom server with:

```bash
npm run start
# or
yarn start
```

## Env Vars

Running the auth server requires:

- A free [https://certs.dock.io/](Dock Certs API key) in order to verify credentials. Set through API_KEY
- A memcached instance, you can find many free ones online for a small project or use a local docker container. Set through MEMCACHIER_SERVERS
- A secure, randomly generated cryptographic key for authorizing clients set through CRYPTO_KEY
- A public domain set through SERVER_URL (defaults to localhost:3000)

Example `.env.local` file:
```
API_KEY=certs-api-key
MEMCACHIER_SERVERS=your-memcached-uri:11211
CRYPTO_KEY=32charactersecurecryptokey
SERVER_URL=https://mydomain.com/
```

## Vercel Deploy

Deploy to vercel in one click with this button

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fdocknetwork%2Fauth-server&env=MEMCACHIER_SERVERS,API_KEY,CRYPTO_KEY&envDescription=Environment%20variables%20needed%20for%20this%20applicaton&envLink=https%3A%2F%2Fgithub.com%2Fdocknetwork%2Fauth-server%23env-vars&project-name=did-auth&repo-name=did-auth&redirect-url=https%3A%2F%2Fdock.io%2F%3Fgtm_source%3Dauthdeploy)
